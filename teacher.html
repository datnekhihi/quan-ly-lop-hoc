<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng ƒêi·ªÅu Khi·ªÉn Gi√°o Vi√™n</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 20px; min-height: 100vh;
            background: url('https://static.vinwonders.com/2023/02/kinh-thanh-hue-4.jpg') no-repeat center center fixed;
            background-size: cover; font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column; align-items: center;
        }
        .container {
            width: 100%; max-width: 600px;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(15px);
            border-radius: 25px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        h2 { text-align: center; text-transform: uppercase; letter-spacing: 2px; color: #55efc4; }
        
        .section-title { font-size: 18px; font-weight: bold; margin: 20px 0 10px; border-left: 4px solid #55efc4; padding-left: 10px; }
        
        /* Danh s√°ch h·ªçc sinh */
        .card {
            background: rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 15px; margin-bottom: 10px; display: flex;
            justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .score-controls button {
            padding: 5px 12px; margin-left: 5px; border-radius: 8px; border: none;
            cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn-up { background: #55efc4; color: #000; }
        .btn-down { background: #ff7675; color: white; }

        /* Danh s√°ch xin ngh·ªâ */
        .absent-card {
            background: rgba(255, 118, 117, 0.15); border: 1px solid rgba(255, 118, 117, 0.3);
            border-radius: 15px; padding: 15px; margin-bottom: 10px;
        }
        .absent-name { font-weight: bold; color: #ff7675; }
        .absent-reason { font-size: 14px; margin-top: 5px; font-style: italic; opacity: 0.9; }
        
        .btn-back { position: absolute; top: 15px; left: 15px; color: white; text-decoration: none; background: rgba(0,0,0,0.5); padding: 8px 15px; border-radius: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <a href="index.html" class="btn-back">‚Üê Tho√°t</a>

    <div class="container">
        <h2>GI√ÅO VI√äN QU·∫¢N L√ù</h2>
        
        <div class="section-title">QU·∫¢N L√ù ƒêI·ªÇM (USERS)</div>
        <div id="student-list">ƒêang t·∫£i...</div>

        <div class="section-title">DANH S√ÅCH XIN NGH·ªà</div>
        <div id="absent-list">Ch∆∞a c√≥ ai xin ngh·ªâ.</div>
    </div>

<script>
    const firebaseConfig = {apiKey: "AIzaSyBuwC_mqQ0uO-5NSHLIJ5wq11dB-2kIop8",
        authDomain: "quanly-428c3.firebaseapp.com",
        databaseURL: "https://quanly-428c3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quanly-428c3",
        storageBucket: "quanly-428c3.firebasestorage.app",
        messagingSenderId: "1061659403130",
        appId: "1:1061659403130:web:1a2a23280ae1de0d3ecc3"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 1. T·∫£i danh s√°ch h·ªçc sinh & ch·ªânh ƒëi·ªÉm
    database.ref('users').on('value', (snap) => {
        const container = document.getElementById('student-list');
        container.innerHTML = "";
        snap.forEach((child) => {
            const id = child.key;
            const data = child.val();
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div>
                    <strong>${data.ten}</strong><br>
                    <small>ƒêi·ªÉm: <span id="score-${id}">${data.diem_ren_luyen}</span></small>
                </div>
                <div class="score-controls">
                    <button class="btn-up" onclick="changeScore('${id}', 1)">+1</button>
                    <button class="btn-down" onclick="changeScore('${id}', -1)">-1</button>
                </div>
            `;
            container.appendChild(div);
        });
    });

    // H√†m c·ªông/tr·ª´ ƒëi·ªÉm
    function changeScore(id, amount) {
        const scoreRef = database.ref('users/' + id + '/diem_ren_luyen');
        scoreRef.transaction((currentScore) => {
            return (currentScore || 0) + amount;
        });
    }

    // 2. T·∫£i danh s√°ch xin ngh·ªâ
    database.ref('xin_nghi').on('value', (snap) => {
        const container = document.getElementById('absent-list');
        container.innerHTML = "";
        if (!snap.exists()) {
            container.innerHTML = "Ch∆∞a c√≥ ƒë∆°n xin ngh·ªâ n√†o.";
            return;
        }
        snap.forEach((child) => {
            const data = child.val();
            const div = document.createElement('div');
            div.className = 'absent-card';
            div.innerHTML = `
                <div class="absent-name">üö© ${data.ten}</div>
                <div class="absent-reason">L√Ω do: ${data.ly_do}</div>
                <div style="font-size:10px; margin-top:5px; opacity:0.6;">G·ª≠i l√∫c: ${data.thoi_gian}</div>
            `;
            container.appendChild(div);
        });
    });
</script>
</body>
</html>
