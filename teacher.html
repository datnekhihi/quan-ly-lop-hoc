<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng ƒêi·ªÅu Khi·ªÉn Gi√°o Vi√™n - Full</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 20px; min-height: 100vh;
            background: url('https://static.vinwonders.com/2023/02/kinh-thanh-hue-4.jpg') no-repeat center center fixed;
            background-size: cover; font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column; align-items: center;
        }
        /* CSS N√∫t tho√°t chu·∫©n */
        .btn-back {
            position: absolute; top: 20px; left: 20px; z-index: 1000;
            background: rgba(0, 0, 0, 0.6); color: white; text-decoration: none;
            padding: 10px 20px; border-radius: 12px; font-weight: bold;
            font-size: 14px; border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        .container {
            width: 100%; max-width: 600px;
            background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(15px);
            border-radius: 25px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; box-shadow: 0 20px 40px rgba(0,0,0,0.5); margin-bottom: 30px;
        }
        h2 { text-align: center; text-transform: uppercase; color: #55efc4; margin-top: 0; }
        .section-title { font-size: 18px; font-weight: bold; margin: 25px 0 15px; border-left: 4px solid #55efc4; padding-left: 10px; color: #55efc4; }
        
        .add-box { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; border: 1px dashed rgba(255,255,255,0.3); margin-bottom: 20px; }
        .add-box input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; background: rgba(255,255,255,0.9); font-weight: bold; }
        .btn-add { width: 100%; padding: 12px; background: #55efc4; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        .card {
            background: rgba(255, 255, 255, 0.1); border-radius: 15px;
            padding: 15px; margin-bottom: 10px; display: flex;
            justify-content: space-between; align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .score-controls button { padding: 5px 15px; margin-left: 5px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 18px; }
        .btn-up { background: #55efc4; color: #000; }
        .btn-down { background: #ff7675; color: white; }
        .absent-card { background: rgba(255, 118, 117, 0.15); border: 1px solid rgba(255, 118, 117, 0.3); border-radius: 15px; padding: 15px; margin-bottom: 10px; }
    </style>
</head>
<body><a href="index.html" class="btn-back">‚Üê Tho√°t</a>

    <div class="container">
        <h2>GI√ÅO VI√äN QU·∫¢N L√ù</h2>

        <div class="section-title">‚ûï TH√äM H·ªåC SINH M·ªöI</div>
        <div class="add-box">
            <input type="text" id="new-id" placeholder="M√£ s·ªë (V√≠ d·ª•: HS04)">
            <input type="text" id="new-name" placeholder="H·ªç v√† t√™n h·ªçc sinh">
            <button class="btn-add" onclick="createNewStudent()">T·∫†O T√ÄI KHO·∫¢N</button>
        </div>
        
        <div class="section-title">üìä QU·∫¢N L√ù ƒêI·ªÇM (USERS)</div>
        <div id="student-list">ƒêang t·∫£i danh s√°ch...</div>

        <div class="section-title">üö© DANH S√ÅCH XIN NGH·ªà</div>
        <div id="absent-list">Ch∆∞a c√≥ ai xin ngh·ªâ.</div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBuwC_mqQ0uO-5NSHLIJ5wq11dB-2kIop8",
        authDomain: "quanly-428c3.firebaseapp.com",
        databaseURL: "https://quanly-428c3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quanly-428c3",
        storageBucket: "quanly-428c3.firebasestorage.app",
        messagingSenderId: "1061659403130",
        appId: "1:1061659403130:web:1a2a23280ae1de0d3ecc3"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // H√ÄM KI·ªÇM TRA ƒêI TR·ªÑ
    function checkLate(timeStr) {
        if (!timeStr || timeStr === "") return "";
        const parts = timeStr.split(':');
        const hour = parseInt(parts[0]);
        const minute = parseInt(parts[1]);
        if (hour > 6 || (hour === 6 && minute > 55)) {
            return '<span style="background:#ffeaa7; color:#d63031; padding:2px 5px; border-radius:5px; font-size:10px; margin-left:5px; border:1px solid #fab1a0; font-weight:bold;">TR·ªÑ</span>';
        }
        return '<span style="background:#55efc4; color:#000; padding:2px 5px; border-radius:5px; font-size:10px; margin-left:5px; font-weight:bold;">ƒê√öNG GI·ªú</span>';
    }

    // T·∫†O T√ÄI KHO·∫¢N M·ªöI
    function createNewStudent() {
        const id = document.getElementById('new-id').value.trim().toUpperCase();
        const name = document.getElementById('new-name').value.trim();
        if (!id || !name) return alert("Nh·∫≠p ƒë·ªß M√£ s·ªë v√† T√™n!");
        database.ref('users/' + id).set({ ten: name, diem_ren_luyen: 100, id: id })
        .then(() => { alert("Th√†nh c√¥ng!"); document.getElementById('new-id').value = ""; document.getElementById('new-name').value = ""; });
    }

    // T·∫¢I DANH S√ÅCH H·ªåC SINH
    database.ref('users').on('value', (snap) => {
        const container = document.getElementById('student-list');
        container.innerHTML = "";
        snap.forEach((child) => {
            const id = child.key;
            const data = child.val();
            const lateStatus = checkLate(data.gio_diem_danh);
            const div = document.createElement('div');
            div.className = 'card';div.innerHTML = `
                <div>
                    <strong>${data.ten}</strong> ${lateStatus}<br>
                    <small style="opacity:0.8">ID: ${id} | ƒêi·ªÉm: <span id="score-${id}">${data.diem_ren_luyen}</span></small>
                    <div style="font-size:10px; color:#55efc4; margin-top:2px;">üïí L√∫c: ${data.gio_diem_danh || '--:--'}</div>
                </div>
                <div class="score-controls">
                    <button class="btn-up" onclick="changeScore('${id}', 1)">+</button>
                    <button class="btn-down" onclick="changeScore('${id}', -1)">-</button>
                    <button style="background:none; border:none; color:#ff7675; cursor:pointer; font-size:12px;" onclick="deleteStudent('${id}')">üóëÔ∏è</button>
                </div>
            `;
            container.appendChild(div);
        });
    });

    function changeScore(id, amount) {
        database.ref('users/' + id + '/diem_ren_luyen').transaction(c => (c || 0) + amount);
    }

    function deleteStudent(id) {
        if(confirm("X√≥a h·ªçc sinh n√†y?")) database.ref('users/' + id).remove();
    }

    // DANH S√ÅCH XIN NGH·ªà
    database.ref('xin_nghi').on('value', (snap) => {
        const container = document.getElementById('absent-list');
        container.innerHTML = "";
        if (!snap.exists()) { container.innerHTML = "Ch∆∞a c√≥ ai xin ngh·ªâ."; return; }
        snap.forEach((child) => {
            const data = child.val();
            const div = document.createElement('div');
            div.className = 'absent-card';
            div.innerHTML = `<div style="font-weight:bold; color:#ff7675;">üö© ${data.ten}</div><div>L√Ω do: ${data.ly_do}</div><div style="font-size:10px; opacity:0.6;">${data.thoi_gian}</div>`;
            container.appendChild(div);
        });
    });
</script>
</body>
</html>
