<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Học Sinh - Smart Attendee</title>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * { box-sizing: border-box; } /* Sửa lỗi tràn màn hình ở ảnh 9 */
        body { 
            margin: 0; min-height: 100vh; display: flex; justify-content: center; align-items: center; 
            background: url('https://static.vinwonders.com/2023/02/kinh-thanh-hue-4.jpg') no-repeat center center fixed; 
            background-size: cover; font-family: 'Segoe UI', sans-serif; overflow: hidden;
        }
        
        /* Nút thoát cố định ở góc */
        .btn-exit { 
            position: fixed; top: 15px; left: 15px; color: white; text-decoration: none; 
            background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 10px; 
            font-size: 14px; z-index: 9999; border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
        }

        .glass-card { 
            background: rgba(0, 0, 0, 0.7); border-radius: 25px; padding: 20px; 
            text-align: center; width: 90%; max-width: 340px; 
            border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(15px); color: white;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        h1 { font-size: 48px; margin: 5px 0; color: #55efc4; }
        #video { border-radius: 15px; width: 100%; height: auto; aspect-ratio: 4/3; object-fit: cover; border: 2px solid #55efc4; margin: 10px 0; }
        .status-box { padding: 10px; border-radius: 10px; background: rgba(85, 239, 196, 0.1); color: #55efc4; font-size: 14px; margin-bottom: 10px; }
        input { width: 100%; padding: 12px; border-radius: 10px; border: none; background: rgba(255,255,255,0.15); color: white; margin-bottom: 10px; text-align: center; }
        .btn-red { width: 100%; padding: 12px; border-radius: 10px; border: none; background: #ff7675; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <a href="index.html" class="btn-exit">← Thoát</a>

    <div class="glass-card">
        <h2 id="student-name" style="margin:0; font-size: 20px;">ĐANG TẢI...</h2>
        <h1 id="student-score">--</h1>
        <p style="font-size: 10px; opacity: 0.7; margin-bottom: 15px;">ĐIỂM RÈN LUYỆN</p>
        
        <video id="video" autoplay muted playsinline></video>
        <div id="face-status" class="status-box">Đang khởi động AI...</div>
        
        <input type="text" id="reason-input" placeholder="Lý do xin nghỉ..."><button class="btn-red" onclick="guiDonXinNghi()">GỬI ĐƠN XIN NGHỈ</button>
    </div>

<script>
    // CẤU HÌNH CHUẨN TỪ FIREBASE CỦA BẠN (Ảnh 4)
    const firebaseConfig = {
        apiKey: "AIzaSyBuwC_mqQ0uO-5NSHLIJ5wq11dB-2kIop8",
        authDomain: "quanly-428c3.firebaseapp.com",
        databaseURL: "https://quanly-428c3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "quanly-428c3",
        storageBucket: "quanly-428c3.firebasestorage.app",
        messagingSenderId: "1061659403130",
        appId: "1:1061659403130:web:1a2a23280ae1de0d3ecc3"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Lấy thông tin từ node HS01 như trong ảnh 4
    function loadData() {
        database.ref('HS01').on('value', snap => {
            const data = snap.val();
            if (data) {
                document.getElementById('student-name').innerText = data.ten;
                document.getElementById('student-score').innerText = data.diem_ren_luyen;
            }
        });
    }

    // Tự động quét FaceID (Xóa nút xác nhận theo yêu cầu)
    async function initAI() {
        const MODEL_URL = 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/';
        await Promise.all([
            faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
            faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)
        ]);
        const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
        document.getElementById('video').srcObject = stream;
        
        setInterval(async () => {
            const detections = await faceapi.detectAllFaces('video', new faceapi.TinyFaceDetectorOptions());
            if (detections.length > 0) {
                document.getElementById('face-status').innerText = "✅ ĐÃ ĐIỂM DANH TỰ ĐỘNG";
                // Gửi lệnh điểm danh lên Firebase ở đây
            }
        }, 2000);
    }

    function guiDonXinNghi() {
        const lyDo = document.getElementById('reason-input').value;
        if(lyDo) {
            database.ref('HS01').update({ ly_do_nghi: lyDo });
            alert("Đã gửi đơn!");
        }
    }

    loadData();
    initAI();
</script>
</body>
</html>
